<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BudgetPal - Your Smart Expense Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles & Default Theme */
        :root {
            --bg-color-rgba: 241, 245, 249; /* slate-100 */
            --text-color: #1e293b; /* slate-800 */
            --primary-color: #6366f1; /* indigo-500 */
            --secondary-color: #818cf8; /* indigo-400 */
            --header-bg: linear-gradient(135deg, #6366f1, #8b5cf6);
            --card-bg: rgba(255, 255, 255, 0.7);
            --sidebar-bg: #ffffff;
            --font-sans: 'Inter', sans-serif;
        }

        /* Theme Dark */
        .theme-dark {
            --bg-color-rgba: 30, 41, 59; /* slate-800 */
            --text-color: #f1f5f9; /* slate-100 */
            --primary-color: #818cf8; /* indigo-400 */
            --secondary-color: #a78bfa; /* violet-400 */
            --header-bg: linear-gradient(135deg, #3730a3, #5b21b6);
            --card-bg: rgba(51, 65, 85, 0.7); /* slate-700 */
            --sidebar-bg: #1e293b; /* slate-800 */
        }

        /* Theme Sunset */
        .theme-sunset {
            --bg-color-rgba: 255, 247, 237; /* orange-50 */
            --text-color: #7c2d12; /* orange-900 */
            --primary-color: #f97316; /* orange-500 */
            --secondary-color: #fb923c; /* orange-400 */
            --header-bg: linear-gradient(135deg, #fb923c, #f97316);
        }

        /* Theme Ocean */
        .theme-ocean {
            --bg-color-rgba: 239, 246, 255; /* blue-50 */
            --text-color: #1e3a8a; /* blue-900 */
            --primary-color: #3b82f6; /* blue-500 */
            --secondary-color: #60a5fa; /* blue-400 */
            --header-bg: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        /* Theme Forest */
        .theme-forest {
            --bg-color-rgba: 240, 253, 244; /* green-50 */
            --text-color: #14532d; /* green-900 */
            --primary-color: #22c55e; /* green-500 */
            --secondary-color: #4ade80; /* green-400 */
            --header-bg: linear-gradient(135deg, #4ade80, #22c55e);
        }
        
        body {
            font-family: var(--font-sans);
            background-image: url('https://images.unsplash.com/photo-1554147090-e1221a04a025?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-color);
            transition: color 0.5s ease;
        }

        .main-content-area {
            background-color: rgba(var(--bg-color-rgba), 0.85);
            backdrop-filter: blur(12px);
            transition: background-color 0.5s ease;
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            transition: background-color 0.5s ease;
        }
        
        .header {
            background: var(--header-bg);
            transition: background 0.5s ease;
        }

        .view { display: none; }
        .view.active {
            display: block;
            animation: fadeIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-item {
            position: relative;
            transition: all 0.3s ease;
        }
        .nav-item:after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--secondary-color);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        .nav-item:hover {
            background-color: rgba(var(--bg-color-rgba), 0.5);
            transform: translateX(4px);
        }
        .nav-item.active {
            background-color: var(--primary-color);
            color: white;
        }
        .nav-item.active:after {
            transform: scaleY(1);
        }
        
        .button-primary {
            background-color: var(--primary-color);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .button-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        .card-interactive {
            background-color: var(--card-bg);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-interactive:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .toast {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            transform: translateY(100%);
            opacity: 0;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .achievement-locked { filter: grayscale(100%); opacity: 0.5; }
        .calendar-day {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <aside class="sidebar w-20 md:w-64 bg-white shadow-lg flex flex-col z-10">
            <div class="flex items-center justify-center md:justify-start md:pl-4 h-20 border-b">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <div class="relative w-10 h-10">
                        <div class="absolute bottom-0 left-0 w-8 h-8 bg-indigo-200 rounded-full"></div>
                        <div class="absolute top-0 right-0 w-8 h-8 bg-indigo-500 rounded-full border-4 border-white"></div>
                    </div>
                </div>
                <!-- Name -->
                <span class="hidden md:inline text-2xl font-bold ml-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-transparent bg-clip-text">BudgetPal</span>
            </div>

            <div class="p-4">
                <button id="add-expense-btn" class="w-full button-primary text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 md:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    <span class="hidden md:inline">Add Expense</span>
                </button>
            </div>

            <nav class="flex-grow border-t">
                <a href="#dashboard" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Dashboard</span>
                </a>
                <a href="#budgets" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Budgets</span>
                </a>
                 <a href="#goals" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293a1 1 0 010 1.414L11 15H9v-2l6.707-6.707a1 1 0 011.414 0z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Goals</span>
                </a>
                <a href="#groups" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Groups</span>
                </a>
                 <a href="#achievements" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Achievements</span>
                </a>
                 <a href="#" id="streak-nav-item" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Monthly Streak</span>
                </a>
                <a href="#contact" class="nav-item flex items-center py-4 px-6 text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:inline ml-4 font-medium">Contact</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="header flex justify-between items-center p-6 border-b text-white shadow-lg">
                <div>
                    <h1 id="header-title" class="text-2xl font-semibold">Dashboard</h1>
                    <p id="header-greeting" class="text-sm opacity-80"></p>
                </div>
                <button id="theme-switcher" class="p-2 rounded-full bg-white bg-opacity-25 text-white hover:bg-opacity-50 transition-colors duration-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                </button>
            </header>

            <main class="main-content-area flex-1 overflow-x-hidden overflow-y-auto p-6">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center gap-4 card-interactive">
                             <img src="https://img.icons8.com/plasticine/100/stack-of-money.png" alt="stack of money" class="w-12 h-12"/>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Personal Spent (Month)</h3>
                                <p id="total-spent" class="text-2xl font-bold">â‚¹0.00</p>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center gap-4 card-interactive">
                             <img src="https://img.icons8.com/plasticine/100/goal.png" alt="goal" class="w-12 h-12"/>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Main Budget</h3>
                                <p id="main-budget-status" class="text-2xl font-bold">â‚¹0 / â‚¹0</p>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center gap-4 card-interactive">
                            <img src="https://img.icons8.com/plasticine/100/fire-element--v1.png" alt="fire element" class="w-12 h-12"/>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Daily Streak</h3>
                                <p id="daily-streak" class="text-2xl font-bold">0</p>
                            </div>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow-md flex items-center gap-4 card-interactive">
                            <img src="https://img.icons8.com/plasticine/100/star.png" alt="star" class="w-12 h-12"/>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Savings Points</h3>
                                <p id="savings-points" class="text-2xl font-bold">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md mb-6 card-interactive">
                        <h3 class="text-sm font-medium text-gray-500">Quote of the day</h3>
                        <p id="quote" class="text-lg italic mt-2"></p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                        <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-md card-interactive">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold">Spending Trend (Last 6 Months)</h3>
                                <button id="export-csv-btn" class="text-sm button-primary text-white font-bold py-2 px-3 rounded-lg">Export Data</button>
                            </div>
                            <div class="chart-container relative h-80">
                                <canvas id="spending-trend-chart"></canvas>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md card-interactive">
                            <h3 class="font-semibold mb-4">Recent Transactions</h3>
                            <div id="recent-transactions" class="space-y-4 overflow-y-auto max-h-80">
                                <!-- Transactions will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Budgets View -->
                <div id="budgets-view" class="view">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white p-8 rounded-lg shadow-lg card-interactive">
                            <h2 class="text-2xl font-bold mb-6 text-center">Set Your Budgets</h2>
                            <form id="budget-form">
                                <div class="mb-4">
                                    <label for="budget-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <select id="budget-category" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></select>
                                </div>
                                <div class="mb-6">
                                    <label for="budget-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                    <input type="number" id="budget-amount" placeholder="e.g., 25000" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                                </div>
                                <button type="submit" class="w-full button-primary text-white font-bold py-3 px-4 rounded-lg">Set Budget</button>
                            </form>
                        </div>
                        <div class="bg-white p-8 rounded-lg shadow-lg card-interactive">
                            <h2 class="text-2xl font-bold mb-6 text-center">Add Custom Category</h2>
                            <form id="custom-category-form">
                                <div class="mb-4">
                                    <label for="custom-category-name" class="block text-sm font-medium text-gray-700 mb-1">Category Name</label>
                                    <input type="text" id="custom-category-name" placeholder="e.g., Investments" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                </div>
                                <div class="mb-6">
                                    <label for="custom-category-icon" class="block text-sm font-medium text-gray-700 mb-1">Icon (Emoji)</label>
                                    <input type="text" id="custom-category-icon" placeholder="e.g., ðŸ“ˆ" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                </div>
                                <button type="submit" class="w-full button-primary text-white font-bold py-3 px-4 rounded-lg">Add Category</button>
                            </form>
                        </div>
                    </div>
                    <div id="budgets-list" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                         <!-- Budget progress bars will be injected here -->
                    </div>
                </div>
                
                <!-- Goals View -->
                <div id="goals-view" class="view">
                     <div class="bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto mb-8 card-interactive">
                        <h2 class="text-2xl font-bold mb-6 text-center">Create a Savings Goal</h2>
                        <form id="goal-form">
                            <div class="mb-4">
                                <label for="goal-name" class="block text-sm font-medium text-gray-700 mb-1">Goal Name</label>
                                <input type="text" id="goal-name" placeholder="e.g., New Laptop" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                            </div>
                            <div class="mb-6">
                                <label for="goal-amount" class="block text-sm font-medium text-gray-700 mb-1">Target Amount (â‚¹)</label>
                                <input type="number" id="goal-amount" placeholder="e.g., 80000" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                            </div>
                            <button type="submit" class="w-full button-primary text-white font-bold py-3 px-4 rounded-lg">Create Goal</button>
                        </form>
                    </div>
                    <div id="goals-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Savings goals will be injected here -->
                    </div>
                </div>

                <!-- Groups View -->
                <div id="groups-view" class="view">
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-5xl mx-auto card-interactive">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                             <div class="flex items-center gap-4">
                                <label for="group-selector" class="text-lg font-semibold">Select Group:</label>
                                <select id="group-selector" class="p-2 border border-gray-300 rounded-md"></select>
                            </div>
                            <button id="create-group-btn" class="mt-4 md:mt-0 bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300">Create New Group</button>
                        </div>
                        <div id="group-content-area">
                             <!-- Content for selected group will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Achievements View -->
                <div id="achievements-view" class="view">
                    <h2 class="text-3xl font-bold mb-6 text-center">Your Achievements</h2>
                    <div id="achievements-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                        <!-- Achievements will be injected here -->
                    </div>
                </div>
                
                <!-- Contact View -->
                <div id="contact-view" class="view">
                    <div class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto card-interactive">
                        <h2 class="text-3xl font-bold mb-6 text-center">Get In Touch</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Contact Information</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center gap-4">
                                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                        <a href="mailto:kkeshavraja@gmail.com" class="hover:underline">kkeshavraja@gmail.com</a>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 2.172a4 4 0 015.656 0l1.414 1.414a4 4 0 010 5.656l-1.414 1.414a4 4 0 01-5.656 0L10 6.828a4 4 0 010-5.656l1.414-1.414a4 4 0 015.656 0zM10 17l-2.293-2.293a1 1 0 010-1.414L11 10h2v2l-3.293 3.293a1 1 0 01-1.414 0z"></path></svg>
                                        <a href="https://www.linkedin.com/in/keshavraja" target="_blank" class="hover:underline">linkedin.com/in/keshavraja</a>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Send Feedback</h3>
                                <form id="contact-form">
                                    <div class="mb-4">
                                        <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                        <input type="text" id="contact-name" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                    </div>
                                    <div class="mb-4">
                                        <label for="contact-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" id="contact-email" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                                    </div>
                                    <div class="mb-4">
                                        <label for="contact-message" class="block text-sm font-medium text-gray-700 mb-1">Feedback</label>
                                        <textarea id="contact-message" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md" required></textarea>
                                    </div>
                                    <button type="submit" class="w-full button-primary text-white font-bold py-3 px-4 rounded-lg">Send Feedback</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="text-center p-4 text-xs text-gray-500 border-t">
                <p>Â© 2025 BudgetPal. All Rights Reserved. Contact: kkeshavraja@gmail.com</p>
            </footer>
        </div>
    </div>

    <!-- Modals -->
    <div id="expense-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md modal-content transform scale-95">
            <form id="expense-form" class="p-8">
                <h2 class="text-2xl font-bold mb-6">Add a New Expense</h2>
                <input type="hidden" id="expense-id">
                <div class="mb-4">
                    <label for="expense-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <input type="text" id="expense-description" placeholder="e.g., Coffee with friends" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                </div>
                <div class="mb-4">
                    <label for="expense-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount (â‚¹)</label>
                    <input type="number" id="expense-amount" step="0.01" placeholder="e.g., 550.00" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                </div>
                <div class="mb-4">
                    <label for="expense-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                    <select id="expense-category" class="w-full px-3 py-2 border border-gray-300 rounded-md"></select>
                </div>
                <div class="flex items-center mb-6">
                    <input id="expense-recurring" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded">
                    <label for="expense-recurring" class="ml-2 block text-sm text-gray-900">This is a recurring expense</label>
                </div>
                <div class="mb-6">
                    <label for="expense-group-select" class="block text-sm font-medium text-gray-700 mb-1">Add to Group (Optional)</label>
                     <select id="expense-group-select" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="">Personal Expense</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-expense-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="button-primary text-white font-bold py-2 px-4 rounded-lg">Save Expense</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-budget-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md modal-content transform scale-95">
            <form id="edit-budget-form" class="p-8">
                <h2 class="text-2xl font-bold mb-2">Edit Budget</h2>
                <p class="text-gray-600 mb-6" id="edit-budget-category-title"></p>
                <div class="mb-4">
                    <label for="edit-budget-amount" class="block text-sm font-medium text-gray-700 mb-1">New Amount (â‚¹)</label>
                    <input type="number" id="edit-budget-amount" step="0.01" placeholder="e.g., 27500" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                </div>
                <input type="hidden" id="edit-budget-category-hidden">
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" id="cancel-edit-budget-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="button-primary text-white font-bold py-2 px-4 rounded-lg">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="create-group-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md modal-content transform scale-95">
            <form id="create-group-form" class="p-8">
                <h2 class="text-2xl font-bold mb-6">Create a New Group</h2>
                <div class="mb-4">
                    <label for="group-name" class="block text-sm font-medium text-gray-700 mb-1">Group Name</label>
                    <input type="text" id="group-name" placeholder="e.g., Goa Trip, Apartment Mates" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                </div>
                <div class="mb-6">
                    <label for="group-members" class="block text-sm font-medium text-gray-700 mb-1">Members (comma separated)</label>
                    <input type="text" id="group-members" placeholder="e.g., Alex, Maria, Chen" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-create-group-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">Create Group</button>
                </div>
            </form>
        </div>
    </div>

    <div id="streak-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm modal-content transform scale-95">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="calendar-month-year" class="text-lg font-bold"></h2>
                </div>
                <div id="streak-calendar-container-modal">
                    <!-- Calendar will be injected here -->
                </div>
                <div class="flex justify-end mt-6">
                    <button id="cancel-streak-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast fixed bottom-5 right-5 bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg">
        <p id="toast-message"></p>
    </div>
    

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- STATE MANAGEMENT ---
    let state = {
        expenses: [],
        budgets: {},
        groups: [],
        goals: [],
        categories: [
            { name: 'Food', icon: 'ðŸ”' },
            { name: 'Transport', icon: 'ðŸš—' },
            { name: 'Entertainment', icon: 'ðŸŽ¬' },
            { name: 'Utilities', icon: 'ðŸ’¡' },
            { name: 'Shopping', icon: 'ðŸ›ï¸' },
            { name: 'Other', icon: 'â“' }
        ],
        user: {
            name: 'You',
            streak: 0,
            points: 0,
            lastActiveDate: null,
            activeDates: [],
            achievements: {
                firstExpense: false,
                tenTransactions: false,
                firstBudget: false,
                longStreak: false,
                goalSetter: false
            }
        },
        currentView: 'dashboard',
        selectedGroupId: null,
        calendarDate: new Date(),
        currentTheme: 0,
        themes: ['', 'theme-dark', 'theme-sunset', 'theme-ocean', 'theme-forest'],
        quotes: [
            "A budget is telling your money where to go instead of wondering where it went.",
            "Don't save what is left after spending, but spend what is left after saving.",
            "The secret of getting ahead is getting started.",
            "Beware of little expenses. A small leak will sink a great ship.",
            "Financial peace isn't the acquisition of stuff. It's learning to live on less than you make."
        ]
    };

    // --- DOM ELEMENTS ---
    const views = document.querySelectorAll('.view');
    const navItems = document.querySelectorAll('.nav-item');
    const headerTitle = document.getElementById('header-title');
    const headerGreeting = document.getElementById('header-greeting');
    const addExpenseBtn = document.getElementById('add-expense-btn');
    const expenseModal = document.getElementById('expense-modal');
    const cancelExpenseBtn = document.getElementById('cancel-expense-btn');
    const expenseForm = document.getElementById('expense-form');
    const budgetForm = document.getElementById('budget-form');
    const budgetsList = document.getElementById('budgets-list');
    const editBudgetModal = document.getElementById('edit-budget-modal');
    const editBudgetForm = document.getElementById('edit-budget-form');
    const cancelEditBudgetBtn = document.getElementById('cancel-edit-budget-btn');
    const createGroupBtn = document.getElementById('create-group-btn');
    const createGroupModal = document.getElementById('create-group-modal');
    const createGroupForm = document.getElementById('create-group-form');
    const cancelCreateGroupBtn = document.getElementById('cancel-create-group-btn');
    const groupSelector = document.getElementById('group-selector');
    const streakNavItem = document.getElementById('streak-nav-item');
    const streakModal = document.getElementById('streak-modal');
    const cancelStreakBtn = document.getElementById('cancel-streak-btn');
    const streakCalendarContainerModal = document.getElementById('streak-calendar-container-modal');
    const calendarMonthYear = document.getElementById('calendar-month-year');
    const themeSwitcher = document.getElementById('theme-switcher');
    const quoteEl = document.getElementById('quote');
    const goalForm = document.getElementById('goal-form');
    const goalsList = document.getElementById('goals-list');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const customCategoryForm = document.getElementById('custom-category-form');
    const achievementsList = document.getElementById('achievements-list');
    const recentTransactions = document.getElementById('recent-transactions');
    const exportCsvBtn = document.getElementById('export-csv-btn');
    const contactForm = document.getElementById('contact-form');
    let spendingTrendChart;

    // --- NAVIGATION ---
    const navigateTo = (hash) => {
        const viewId = hash.substring(1) + '-view';
        const targetView = document.getElementById(viewId);
        
        if (!targetView) return;

        views.forEach(view => view.classList.remove('active'));
        targetView.classList.add('active');

        navItems.forEach(item => {
            const href = item.getAttribute('href');
            if (href && href.startsWith('#')) {
                item.classList.toggle('active', href === hash);
            }
        });
        
        const title = hash.charAt(1).toUpperCase() + hash.slice(2);
        headerTitle.textContent = title;
        state.currentView = hash.substring(1);
    };

    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const hash = e.currentTarget.getAttribute('href');
            if (hash && hash.startsWith('#')) {
                 navigateTo(hash);
            }
        });
    });
    
    // --- MODAL HANDLING ---
    const openModal = (modal) => {
        modal.classList.remove('hidden');
        setTimeout(() => modal.querySelector('.modal-content').classList.replace('scale-95', 'scale-100'), 10);
    };

    const closeModal = (modal) => {
        modal.querySelector('.modal-content').classList.replace('scale-100', 'scale-95');
        setTimeout(() => modal.classList.add('hidden'), 200);
    };
    
    // --- TOAST NOTIFICATION ---
    const showToast = (message, type = 'success') => {
        toastMessage.textContent = message;
        toast.className = `toast fixed bottom-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    };

    // --- EVENT LISTENERS ---
    addExpenseBtn.addEventListener('click', () => {
        expenseForm.reset();
        document.getElementById('expense-id').value = '';
        openModal(expenseModal);
    });
    cancelExpenseBtn.addEventListener('click', () => closeModal(expenseModal));
    expenseModal.addEventListener('click', (e) => { if (e.target === expenseModal) closeModal(expenseModal); });

    cancelEditBudgetBtn.addEventListener('click', () => closeModal(editBudgetModal));
    editBudgetModal.addEventListener('click', (e) => { if (e.target === editBudgetModal) closeModal(editBudgetModal); });
    
    createGroupBtn.addEventListener('click', () => openModal(createGroupModal));
    cancelCreateGroupBtn.addEventListener('click', () => closeModal(createGroupModal));
    createGroupModal.addEventListener('click', (e) => { if (e.target === createGroupModal) closeModal(createGroupModal); });

    streakNavItem.addEventListener('click', (e) => { 
        e.preventDefault(); 
        state.calendarDate = new Date();
        renderStreakCalendar();
        openModal(streakModal); 
    });
    cancelStreakBtn.addEventListener('click', () => closeModal(streakModal));
    streakModal.addEventListener('click', (e) => { if (e.target === streakModal) closeModal(streakModal); });
    
    exportCsvBtn.addEventListener('click', () => {
        const headers = ['ID', 'Description', 'Amount', 'Category', 'Date', 'Recurring', 'GroupID'];
        const csvContent = "data:text/csv;charset=utf-8," 
            + headers.join(",") + "\n" 
            + state.expenses.map(e => [e.id, e.description, e.amount, e.category, e.date, e.recurring, e.groupId].join(",")).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "budgetpal_expenses.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast('Data exported!');
    });
    
    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        showToast('Message sent! We will get back to you soon.');
        contactForm.reset();
    });

    // --- DATA HANDLING & FORMS ---
    expenseForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('expense-id').value;
        const expenseData = {
            description: document.getElementById('expense-description').value,
            amount: parseFloat(document.getElementById('expense-amount').value),
            category: document.getElementById('expense-category').value,
            recurring: document.getElementById('expense-recurring').checked,
            groupId: document.getElementById('expense-group-select').value || null,
            paidBy: 'You'
        };

        if (id) { // Editing existing expense
            const index = state.expenses.findIndex(ex => ex.id == id);
            state.expenses[index] = { ...state.expenses[index], ...expenseData };
            showToast('Expense updated successfully!');
        } else { // Adding new expense
            const newExpense = {
                id: Date.now(),
                date: new Date().toISOString(),
                ...expenseData
            };
            state.expenses.unshift(newExpense);
            updateStreak();
            showToast('Expense added successfully!');
        }
        
        expenseForm.reset();
        closeModal(expenseModal);
        renderAll();
    });

    budgetForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const category = document.getElementById('budget-category').value;
        const amount = parseFloat(document.getElementById('budget-amount').value);
        state.budgets[category] = amount;
        budgetForm.reset();
        showToast('Budget set!');
        renderAll();
    });

    editBudgetForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const category = document.getElementById('edit-budget-category-hidden').value;
        const newAmount = parseFloat(document.getElementById('edit-budget-amount').value);
        if (category && !isNaN(newAmount)) {
            state.budgets[category] = newAmount;
            closeModal(editBudgetModal);
            showToast('Budget updated!');
            renderAll();
        }
    });

    createGroupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('group-name').value;
        const membersStr = document.getElementById('group-members').value;
        const members = ['You', ...membersStr.split(',').map(m => m.trim()).filter(m => m)];
        const newGroup = {
            id: 'group' + Date.now(),
            name: name,
            members: members
        };
        state.groups.push(newGroup);
        state.selectedGroupId = newGroup.id;
        createGroupForm.reset();
        closeModal(createGroupModal);
        showToast('Group created!');
        renderAll();
    });
    
    goalForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newGoal = {
            id: 'goal' + Date.now(),
            name: document.getElementById('goal-name').value,
            targetAmount: parseFloat(document.getElementById('goal-amount').value),
            currentAmount: 0
        };
        state.goals.push(newGoal);
        goalForm.reset();
        showToast('New goal created!');
        renderAll();
    });
    
    customCategoryForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('custom-category-name').value;
        const icon = document.getElementById('custom-category-icon').value;
        if (name && icon) {
            state.categories.push({ name, icon });
            customCategoryForm.reset();
            showToast('Custom category added!');
            renderAll();
        }
    });

    budgetsList.addEventListener('click', (e) => {
        const editButton = e.target.closest('.edit-budget-btn');
        const deleteButton = e.target.closest('.delete-budget-btn');

        if (editButton) {
            const category = editButton.dataset.category;
            document.getElementById('edit-budget-category-title').textContent = `For category: ${category}`;
            document.getElementById('edit-budget-amount').value = state.budgets[category];
            document.getElementById('edit-budget-category-hidden').value = category;
            openModal(editBudgetModal);
        }

        if (deleteButton) {
            const category = deleteButton.dataset.category;
            if (confirm(`Are you sure you want to delete the "${category}" budget?`)) {
                delete state.budgets[category];
                showToast('Budget deleted!', 'error');
                renderAll();
            }
        }
    });
    
    goalsList.addEventListener('click', (e) => {
        const addSavingsBtn = e.target.closest('.add-savings-btn');
        if (addSavingsBtn) {
            const goalId = addSavingsBtn.dataset.goalId;
            const amount = parseFloat(prompt("How much would you like to add to this goal?", "1000"));
            if (!isNaN(amount) && amount > 0) {
                const goal = state.goals.find(g => g.id === goalId);
                goal.currentAmount += amount;
                showToast(`â‚¹${amount} added to ${goal.name}!`);
                renderAll();
            }
        }
    });

    groupSelector.addEventListener('change', (e) => {
        state.selectedGroupId = e.target.value;
        renderGroups();
    });
    
    recentTransactions.addEventListener('click', (e) => {
        const editBtn = e.target.closest('.edit-expense-btn');
        const deleteBtn = e.target.closest('.delete-expense-btn');

        if (editBtn) {
            const expenseId = editBtn.dataset.id;
            const expense = state.expenses.find(ex => ex.id == expenseId);
            document.getElementById('expense-id').value = expense.id;
            document.getElementById('expense-description').value = expense.description;
            document.getElementById('expense-amount').value = expense.amount;
            document.getElementById('expense-category').value = expense.category;
            document.getElementById('expense-recurring').checked = expense.recurring;
            document.getElementById('expense-group-select').value = expense.groupId || '';
            openModal(expenseModal);
        }

        if (deleteBtn) {
            const expenseId = deleteBtn.dataset.id;
            if (confirm('Are you sure you want to delete this expense?')) {
                state.expenses = state.expenses.filter(ex => ex.id != expenseId);
                showToast('Expense deleted!', 'error');
                renderAll();
            }
        }
    });
    
    // --- DATE & GREETING ---
    const setGreeting = () => {
        const date = new Date();
        const hours = date.getHours();
        let greeting = hours < 12 ? 'Good Morning!' : hours < 18 ? 'Good Afternoon!' : 'Good Evening!';
        const dateString = date.toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        headerGreeting.textContent = `${greeting} Today is ${dateString}.`;
    };

    // --- STREAK & ACHIEVEMENTS LOGIC ---
    const getKolkataDateString = (date) => new Date(date.toLocaleString("en-US", {timeZone: "Asia/Kolkata"})).toISOString().slice(0, 10);

    const updateStreak = () => {
        const todayKolkataStr = getKolkataDateString(new Date());

        if (state.user.lastActiveDate !== todayKolkataStr) {
            if (state.user.lastActiveDate) {
                const lastDate = new Date(state.user.lastActiveDate);
                const todayDate = new Date(todayKolkataStr);
                const diffDays = Math.ceil(Math.abs(todayDate - lastDate) / (1000 * 60 * 60 * 24));
                state.user.streak = (diffDays === 1) ? state.user.streak + 1 : 1;
            } else {
                state.user.streak = 1;
            }
            state.user.lastActiveDate = todayKolkataStr;
            if (!state.user.activeDates.includes(todayKolkataStr)) state.user.activeDates.push(todayKolkataStr);
            if (state.user.streak > 10) state.user.points += 10;
        }
    };
    
    const checkAchievements = () => {
        if (!state.user.achievements.firstExpense && state.expenses.length > 0) {
            state.user.achievements.firstExpense = true;
            showToast('Achievement Unlocked: First Expense!');
        }
        if (!state.user.achievements.tenTransactions && state.expenses.length >= 10) {
            state.user.achievements.tenTransactions = true;
            showToast('Achievement Unlocked: Transaction Pro!');
        }
        if (!state.user.achievements.firstBudget && Object.keys(state.budgets).length > 0) {
            state.user.achievements.firstBudget = true;
            showToast('Achievement Unlocked: Budget Setter!');
        }
        if (!state.user.achievements.longStreak && state.user.streak >= 7) {
            state.user.achievements.longStreak = true;
            showToast('Achievement Unlocked: Weekly Warrior!');
        }
        if (!state.user.achievements.goalSetter && state.goals.length > 0) {
            state.user.achievements.goalSetter = true;
            showToast('Achievement Unlocked: Dream Big!');
        }
    };

    // --- RENDERING FUNCTIONS ---
    const renderAll = () => {
        renderDashboard();
        renderBudgets();
        renderGoals();
        renderGroups();
        populateDropdowns();
        renderStreakCalendar();
        renderQuote();
        checkAchievements();
        renderAchievements();
    };

    const populateDropdowns = () => {
        const expenseGroupSelect = document.getElementById('expense-group-select');
        expenseGroupSelect.innerHTML = '<option value="">Personal Expense</option>';
        state.groups.forEach(group => {
            const option = document.createElement('option');
            option.value = group.id;
            option.textContent = group.name;
            expenseGroupSelect.appendChild(option);
        });

        groupSelector.innerHTML = '';
        state.groups.forEach(group => {
            const option = document.createElement('option');
            option.value = group.id;
            option.textContent = group.name;
            groupSelector.appendChild(option);
        });
        groupSelector.value = state.selectedGroupId;
        
        const budgetCategorySelect = document.getElementById('budget-category');
        const expenseCategorySelect = document.getElementById('expense-category');
        budgetCategorySelect.innerHTML = '';
        expenseCategorySelect.innerHTML = '';
        state.categories.forEach(cat => {
            const option1 = document.createElement('option');
            option1.textContent = `${cat.icon} ${cat.name}`;
            option1.value = cat.name;
            budgetCategorySelect.appendChild(option1);
            
            const option2 = document.createElement('option');
            option2.textContent = `${cat.icon} ${cat.name}`;
            option2.value = cat.name;
            expenseCategorySelect.appendChild(option2);
        });
        const overallOption = document.createElement('option');
        overallOption.textContent = 'ðŸŽ¯ Overall';
        overallOption.value = 'Overall';
        budgetCategorySelect.prepend(overallOption);
    };

    const renderDashboard = () => {
        const personalExpenses = state.expenses.filter(ex => !ex.groupId);
        const totalSpent = personalExpenses.reduce((sum, ex) => sum + ex.amount, 0);
        document.getElementById('total-spent').textContent = `â‚¹${totalSpent.toFixed(2)}`;
        
        const overallBudget = state.budgets['Overall'] || 0;
        document.getElementById('main-budget-status').textContent = `â‚¹${totalSpent.toFixed(2)} / â‚¹${overallBudget.toFixed(2)}`;
        
        document.getElementById('daily-streak').textContent = `${state.user.streak}`;
        document.getElementById('savings-points').textContent = `${state.user.points}`;

        if (state.expenses.length === 0) {
            recentTransactions.innerHTML = '<p class="text-gray-500 text-center">No transactions yet. Add one to get started!</p>';
        } else {
            recentTransactions.innerHTML = '';
            state.expenses.slice(0, 10).forEach(ex => {
                const el = document.createElement('div');
                el.className = 'flex justify-between items-center';
                const recurringIcon = ex.recurring ? `<svg class="w-4 h-4 text-blue-500 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l16 16"></path></svg>` : '';
                el.innerHTML = `
                    <div class="flex-1">
                        <p class="font-medium flex items-center">${ex.description} ${recurringIcon}</p>
                        <p class="text-sm text-gray-500">${ex.groupId ? state.groups.find(g=>g.id===ex.groupId)?.name : ex.category}</p>
                    </div>
                    <p class="font-bold text-red-500 mr-4">-â‚¹${ex.amount.toFixed(2)}</p>
                    <div class="flex gap-2">
                        <button class="btn-icon edit-expense-btn" data-id="${ex.id}"><svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536l12.232-12.232z"></path></svg></button>
                        <button class="btn-icon delete-expense-btn" data-id="${ex.id}"><svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                    </div>
                `;
                recentTransactions.appendChild(el);
            });
        }
        updateSpendingTrendChart();
    };

    const renderBudgets = () => {
        budgetsList.innerHTML = '';
        if (Object.keys(state.budgets).length === 0) {
            budgetsList.innerHTML = '<p class="text-gray-500 text-center col-span-full">You haven\'t set any budgets. Add one using the form above.</p>';
        } else {
            for (const category in state.budgets) {
                const budgetAmount = state.budgets[category];
                const spentAmount = state.expenses
                    .filter(ex => (category === 'Overall' ? true : ex.category === category) && !ex.groupId)
                    .reduce((sum, ex) => sum + ex.amount, 0);
                
                const percentage = budgetAmount > 0 ? Math.min((spentAmount / budgetAmount) * 100, 100) : 0;
                const color = percentage > 90 ? 'bg-red-500' : percentage > 70 ? 'bg-yellow-500' : 'bg-indigo-500';

                const el = document.createElement('div');
                el.className = 'bg-white p-4 rounded-lg shadow card-interactive';
                el.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-semibold">${category}</h4>
                            <span class="text-sm font-medium text-gray-600">â‚¹${spentAmount.toFixed(2)} / â‚¹${budgetAmount.toFixed(2)}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="btn-icon edit-budget-btn" data-category="${category}" title="Edit Budget"><svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536l12.232-12.232z"></path></svg></button>
                            <button class="btn-icon delete-budget-btn" data-category="${category}" title="Delete Budget"><svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4"><div class="${color} h-4 rounded-full" style="width: ${percentage}%"></div></div>
                    ${percentage >= 100 ? `<p class="text-red-600 text-sm mt-2 font-semibold">Budget exceeded!</p>` : ''}
                `;
                budgetsList.appendChild(el);
            }
        }
    };
    
    const renderGoals = () => {
        goalsList.innerHTML = '';
        if (state.goals.length === 0) {
            goalsList.innerHTML = '<p class="text-gray-500 text-center col-span-full">No savings goals yet. Create one to start saving!</p>';
        } else {
            state.goals.forEach(goal => {
                const percentage = goal.targetAmount > 0 ? Math.min((goal.currentAmount / goal.targetAmount) * 100, 100) : 0;
                const el = document.createElement('div');
                el.className = 'bg-white p-4 rounded-lg shadow card-interactive';
                el.innerHTML = `
                    <h4 class="font-semibold">${goal.name}</h4>
                    <span class="text-sm font-medium text-gray-600">â‚¹${goal.currentAmount.toFixed(2)} / â‚¹${goal.targetAmount.toFixed(2)}</span>
                    <div class="w-full bg-gray-200 rounded-full h-4 my-2"><div class="bg-green-500 h-4 rounded-full" style="width: ${percentage}%"></div></div>
                    <button class="add-savings-btn w-full mt-2 text-sm button-primary text-white font-bold py-2 px-3 rounded-lg" data-goal-id="${goal.id}">Add to Savings</button>
                `;
                goalsList.appendChild(el);
            });
        }
    };

    const renderGroups = () => {
        const groupContentArea = document.getElementById('group-content-area');
        const selectedGroup = state.groups.find(g => g.id === state.selectedGroupId);

        if (!selectedGroup) {
            groupContentArea.innerHTML = `<div class="text-center py-12"><h3 class="text-xl font-semibold text-gray-700">No group selected</h3><p class="text-gray-500 mt-2">Create a new group or select one from the dropdown to get started.</p></div>`;
            return;
        }

        const groupExpenses = state.expenses.filter(ex => ex.groupId === selectedGroup.id);
        const totalGroupSpent = groupExpenses.reduce((sum, ex) => sum + ex.amount, 0);
        const members = selectedGroup.members;
        const sharePerPerson = members.length > 0 ? totalGroupSpent / members.length : 0;

        const paidByMember = {};
        members.forEach(member => paidByMember[member] = 0);
        groupExpenses.forEach(ex => {
            if(paidByMember.hasOwnProperty(ex.paidBy)) paidByMember[ex.paidBy] += ex.amount;
        });

        const balances = {};
        members.forEach(member => { balances[member] = paidByMember[member] - sharePerPerson; });

        const settlements = [];
        const debtors = members.filter(m => balances[m] < 0);
        const creditors = members.filter(m => balances[m] > 0);
        
        debtors.forEach(debtor => {
            let amountOwed = -balances[debtor];
            creditors.forEach(creditor => {
                if (amountOwed <= 0) return;
                let amountCanReceive = balances[creditor];
                if (amountCanReceive > 0) {
                    const payment = Math.min(amountOwed, amountCanReceive);
                    settlements.push({ from: debtor, to: creditor, amount: payment });
                    balances[debtor] += payment;
                    balances[creditor] -= payment;
                    amountOwed -= payment;
                }
            });
        });
        
        let balancesHtml = '';
        if (settlements.length > 0) {
            settlements.forEach(s => {
                if (s.amount > 0.01) {
                    balancesHtml += `<div class="bg-gray-100 p-3 rounded-md flex justify-between items-center"><span><span class="font-bold">${s.from}</span> owes <span class="font-bold">${s.to}</span></span> <span class="font-bold text-green-600">â‚¹${s.amount.toFixed(2)}</span></div>`;
                }
            });
        }
        if (balancesHtml === '') balancesHtml = `<p class="text-gray-500">Everyone is settled up!</p>`;

        let transactionsHtml = '';
        if(groupExpenses.length > 0) {
            groupExpenses.forEach(ex => {
                transactionsHtml += `<div class="flex justify-between items-center"><div><p class="font-medium">${ex.description}</p><p class="text-sm text-gray-500">Paid by ${ex.paidBy}</p></div><p class="font-bold">-â‚¹${ex.amount.toFixed(2)}</p></div>`;
            });
        } else {
            transactionsHtml = `<p class="text-gray-500">No transactions for this group yet.</p>`;
        }

        groupContentArea.innerHTML = `
            <h2 class="text-2xl font-bold mb-6 text-center" id="group-view-title">Group: ${selectedGroup.name}</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Balances (Who Owes Whom)</h3>
                    <div class="space-y-3">${balancesHtml}</div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Group Transactions</h3>
                    <div class="space-y-4 overflow-y-auto max-h-64">${transactionsHtml}</div>
                </div>
            </div>
        `;
    };

    const renderStreakCalendar = () => {
        const date = new Date();
        const todayKolkataStr = getKolkataDateString(date);
        const currentMonth = date.getMonth();
        const currentYear = date.getFullYear();

        calendarMonthYear.textContent = `${date.toLocaleString('default', { month: 'long' })} ${currentYear}`;

        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        let calendarHtml = `<div class="grid grid-cols-7 gap-2 text-center text-xs text-gray-500 font-bold">`;
        ['S', 'M', 'T', 'W', 'T', 'F', 'S'].forEach(day => calendarHtml += `<div>${day}</div>`);
        calendarHtml += `</div>`;
        calendarHtml += `<div class="grid grid-cols-7 gap-2 mt-2">`;

        for (let i = 0; i < firstDayOfMonth; i++) {
            calendarHtml += `<div></div>`;
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            let classes = 'calendar-day';
            if (state.user.activeDates.includes(dateStr)) {
                classes += ' bg-green-200 text-green-800';
            }
            if (dateStr === todayKolkataStr) {
                classes += ' bg-indigo-500 text-white font-bold';
            }
            calendarHtml += `<div class="${classes}">${day}</div>`;
        }

        calendarHtml += `</div>`;
        streakCalendarContainerModal.innerHTML = calendarHtml;
    };
    
    const renderAchievements = () => {
        const achievementsMap = {
            firstExpense: { title: 'First Expense', icon: 'ðŸŽ‰', desc: 'Log your first transaction' },
            tenTransactions: { title: 'Transaction Pro', icon: 'ðŸ’¼', desc: 'Log 10 transactions' },
            firstBudget: { title: 'Budget Setter', icon: 'ðŸŽ¯', desc: 'Create your first budget' },
            longStreak: { title: 'Weekly Warrior', icon: 'ðŸ”¥', desc: 'Maintain a 7-day streak' },
            goalSetter: { title: 'Dream Big', icon: 'ðŸš€', desc: 'Create a savings goal' }
        };
        
        achievementsList.innerHTML = '';
        for (const key in state.user.achievements) {
            const unlocked = state.user.achievements[key];
            const details = achievementsMap[key];
            const el = document.createElement('div');
            el.className = `bg-white p-4 rounded-lg shadow text-center card-interactive ${!unlocked ? 'achievement-locked' : ''}`;
            el.innerHTML = `
                <div class="text-4xl">${details.icon}</div>
                <h4 class="font-bold mt-2">${details.title}</h4>
                <p class="text-sm text-gray-500">${details.desc}</p>
            `;
            achievementsList.appendChild(el);
        }
    };

    // --- CHART.JS ---
    const initCharts = () => {
        const trendCtx = document.getElementById('spending-trend-chart').getContext('2d');
        spendingTrendChart = new Chart(trendCtx, {
            type: 'bar',
            data: { labels: [], datasets: [{ label: 'Total Spent', data: [], backgroundColor: 'rgba(79, 70, 229, 0.7)' }] },
            options: { responsive: true, maintainAspectRatio: false }
        });
    };

    const updateSpendingTrendChart = () => {
        const monthlySpending = {};
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        
        for (let i = 5; i >= 0; i--) {
            const d = new Date();
            d.setMonth(d.getMonth() - i);
            const monthKey = `${d.getFullYear()}-${monthNames[d.getMonth()]}`;
            monthlySpending[monthKey] = 0;
        }

        state.expenses.filter(ex => !ex.groupId).forEach(ex => {
            const d = new Date(ex.date);
            const monthKey = `${d.getFullYear()}-${monthNames[d.getMonth()]}`;
            if (monthlySpending.hasOwnProperty(monthKey)) {
                monthlySpending[monthKey] += ex.amount;
            }
        });

        spendingTrendChart.data.labels = Object.keys(monthlySpending);
        spendingTrendChart.data.datasets[0].data = Object.values(monthlySpending);
        spendingTrendChart.update();
    };

    // --- THEME & QUOTE ---
    themeSwitcher.addEventListener('click', () => {
        state.currentTheme = (state.currentTheme + 1) % state.themes.length;
        document.body.className = state.themes[state.currentTheme];
    });

    const renderQuote = () => {
        const randomIndex = Math.floor(Math.random() * state.quotes.length);
        quoteEl.textContent = state.quotes[randomIndex];
    };
    
    // --- INITIALIZATION ---
    const init = () => {
        setGreeting();
        initCharts();
        navigateTo('#dashboard');
        renderAll();
    };

    init();
});
</script>

</body>
</html>
